<h1><%= "#{character.first_name} #{character.last_name}" %> Choose Skills</h1>
<p>Choose your skill occupation.  The skill occupation is for choosing
  your occupation-specific skills, and does not have to exactly match
  your previously chosen character's occupation.  However, it should
  appropriately represent your character's occupational skills.  For
  example, if your character's occupation is "Train Conductor," the
  closest match for skill occupation would be "Pilot."  If you cannot
  find an appropriate skill set for your chosen occupation, chose "other",
  but be sure to consult with your GM.</p>

<%= f.select( :skill_occupation,
              options_for_select(
                      [['---Choose Occupation---', '']] +
                              occupations.keys.collect do |occupation|
                                [sym_to_title( occupation ), occupation]
                              end ,
                      character.skill_set.skill_occupation
              )) %>
<table id="occupational_skill_table"></table>
<br/>
<div>
  Total Professional Skill Points:
    <span id="occ_total" original="<%= character.characteristic_set.occupation_skill_points %>">
        <%= character.characteristic_set.occupation_skill_points %>
    </span>
</div>
<div>
  Total Personal Interest Skill Points:
    <span id="pi_total" original="<%= character.characteristic_set.personal_interest_points %>">
      <%= character.characteristic_set.personal_interest_points %>
    </span>
</div>
<br/>

<table id="skill_table">
  <thead>
    <th>Skill</th>
    <th>Spent</th>
    <th>Total</th>
    <th>Skill</th>
    <th>Spent</th>
    <th>Total</th>
    <th>Skill</th>
    <th>Spent</th>
    <th>Total</th>
  </thead>

  <tr>
    <%= render 'skill_table_input', f: f, skill: :accounting, character: character %>
    <%= render 'skill_table_input', f: f, skill: :drive_auto, character: character %>

    <td><%= table_title :other_language %></td>
    <td></td>
    <td></td>
  </tr>

  <tr>
    <%= render 'skill_table_input', f: f, skill: :anthropology, character: character %>
    <%= render 'skill_table_input', f: f, skill: :electrical_repair, character: character %>

    <td><%#= f.text_field :other_language_val.to_a[0][0] if skill_set.other_language_val? 0 %></td>
    <td><%#= f.text_field :other_language_val.to_a[0][1] if skill_set.other_language_val? 0 %></td>
    <td></td>
  </tr>

  <tr>
    <%= render 'skill_table_input', f: f, skill: :archaeology, character: character %>
    <%= render 'skill_table_input', f: f, skill: :fast_talk, character: character %>

    <td><%#= f.text_field :other_language_val.to_a[1][0] if skill_set.other_language_val? 1 %></td>
    <td><%#= f.text_field :other_language_val.to_a[1][1] if skill_set.other_language_val? 1 %></td>
    <td></td>
  </tr>

  <tr>
    <td><%#= table_title :art %></td>
    <td></td>
    <td></td>

    <%= render 'skill_table_input', f: f, skill: :first_aid, character: character %>

    <td><%#= f.text_field :other_language_val.to_a[2][0] if skill_set.other_language_val? 2 %></td>
    <td><%#= f.text_field :other_language_val.to_a[2][1] if skill_set.other_language_val? 2 %></td>
    <td></td>
  </tr>

  <tr>
    <td><%#= f.text_field :art_val.to_a[0][0] if skill_set.art_val? 0 %></td>
    <td><%#= f.text_field :art_val.to_a[0][1] if skill_set.art_val? 0%></td>
    <td></td>

    <%= render 'skill_table_input', f: f, skill: :geology, character: character %>
    <%= render 'skill_table_input', f: f, skill: :own_language, character: character %>
  </tr>

  <tr>
    <td><%#= f.text_field :art_val.to_a[1][0] if skill_set.art_val? 1 %></td>
    <td><%#= f.text_field :art_val.to_a[1][1] if skill_set.art_val? 1 %></td>
    <td></td>

    <%= render 'skill_table_input', f: f, skill: :hide, character: character %>
    <%= render 'skill_table_input', f: f, skill: :persuade, character: character %>
  </tr>

  <tr>
    <%= render 'skill_table_input', f: f, skill: :astronomy, character: character %>
    <%= render 'skill_table_input', f: f, skill: :history, character: character %>
    <%= render 'skill_table_input', f: f, skill: :pharmacy, character: character %>
  </tr>

  <tr>
    <%= render 'skill_table_input', f: f, skill: :bargain, character: character %>
    <%= render 'skill_table_input', f: f, skill: :jump, character: character %>
    <%= render 'skill_table_input', f: f, skill: :photography, character: character %>

  </tr>

  <tr>
    <%= render 'skill_table_input', f: f, skill: :biology, character: character %>
    <%= render 'skill_table_input', f: f, skill: :law, character: character %>
    <%= render 'skill_table_input', f: f, skill: :physics, character: character %>
  </tr>

  <tr>
    <%= render 'skill_table_input', f: f, skill: :chemistry, character: character %>
    <%= render 'skill_table_input', f: f, skill: :library_use, character: character %>
    <td><%= table_title :pilot %></td>
    <td></td>
    <td></td>
  </tr>

  <tr>
    <%= render 'skill_table_input', f: f, skill: :climb, character: character %>
    <%= render 'skill_table_input', f: f, skill: :listen, character: character %>

    <td><%#= f.text_field :pilot_val.to_a[0][0] if skill_set.pilot_val? 0 %></td>
    <td><%#= f.text_field :pilot_val.to_a[0][1] if skill_set.pilot_val? 0 %></td>
    <td></td>
  </tr>

  <tr>
    <%= render 'skill_table_input', f: f, skill: :conceal, character: character %>
    <%= render 'skill_table_input', f: f, skill: :locksmith, character: character %>
    <td><%#= f.text_field :pilot_val.to_a[1][0] if skill_set.pilot_val? 1 %></td>
    <td><%#= f.text_field :pilot_val.to_a[1][1] if skill_set.pilot_val? 1 %></td>
    <td></td>
  </tr>

  <tr>
    <td><%= table_title :craft %></td>
    <td></td>
    <td></td>

    <%= render 'skill_table_input', f: f, skill: :martial_arts, character: character %>
    <%= render 'skill_table_input', f: f, skill: :psychoanalysis, character: character %>
  </tr>

  <tr>
    <td><%#= f.text_field :craft_val.to_a[0][0] if skill_set.craft_val? 0 %></td>
    <td><%#= f.text_field :craft_val.to_a[0][1] if skill_set.craft_val? 0 %></td>
    <td></td>

    <%= render 'skill_table_input', f: f, skill: :mechanical_repair, character: character %>
    <%= render 'skill_table_input', f: f, skill: :psychology, character: character %>
  </tr>

  <tr>
    <td><%#= f.text_field :craft_val.to_a[1][0] if skill_set.craft_val? 1 %></td>
    <td><%#= f.text_field :craft_val.to_a[1][1] if skill_set.craft_val? 1 %></td>
    <td></td>

    <%= render 'skill_table_input', f: f, skill: :medicine, character: character %>
    <%= render 'skill_table_input', f: f, skill: :ride, character: character %>
  </tr>

  <tr>
    <%= render 'skill_table_input', f: f, skill: :credit_rating, character: character %>
    <%= render 'skill_table_input', f: f, skill: :natural_history, character: character %>
    <%= render 'skill_table_input', f: f, skill: :sneak, character: character %>
  </tr>

  <tr>
    <%= render 'skill_table_input', f: f, skill: :cthulhu_mythos, character: character %>
    <%= render 'skill_table_input', f: f, skill: :navigate, character: character %>
    <%= render 'skill_table_input', f: f, skill: :spot_hidden, character: character %>
  </tr>

  <tr>
    <%= render 'skill_table_input', f: f, skill: :disguise, character: character %>
    <%= render 'skill_table_input', f: f, skill: :occult, character: character %>
    <%= render 'skill_table_input', f: f, skill: :swim, character: character %>
  </tr>

  <tr>
    <%= render 'skill_table_input', f: f, skill: :dodge, character: character %>
    <%= render 'skill_table_input', f: f, skill: :operate_heavy_machine, character: character %>
    <%= render 'skill_table_input', f: f, skill: :throw, character: character %>
  </tr>

  <tr>
    <td></td>
    <td></td>
    <td></td>

    <td></td>
    <td></td>
    <td></td>

    <%= render 'skill_table_input', f: f, skill: :track, character: character %>
  </tr>

</table>


<%= f.submit 'Submit' %>
<%= %>

<script type="text/javascript">
//  $(window).load(function() {
//    $('.skill_input').change(function(event) {
//      var input = event.target;
//      var inputTd = input.parent('td');
//      var baseTd = inputTd.
//              var skill = inputTd.attr('skill');
//      var totalTd = inputTd.sibling('td.' + skill + '-total');
//      totalTd.total
//
//
//
//
//    });
//  });

  $(window).load(function() {
    var pointTracker = new CoC.SkillPointTracker( {
      occupationalSkillTableId: 'occupational_skill_table',
      skillTableId: 'skill_table',
      occTotalId: 'occ_total',
      piTotalId: 'pi_total'
    });

    var occupationalSkillList = new CoC.OccupationalSkillList( {
      occupational_skill_table: 'occupational_skill_table',
      occupations: <%= occupations_json %>,
      skill_occupation: 'skill_set_skill_occupation',
      all_skills: <%= SkillSet::ALL_SKILLS.to_a.to_json.html_safe %>,
      skill_categories: <%= SkillSet::SKILL_CATEGORIES.to_a.to_json.html_safe %>,
      pointTracker: pointTracker
    });

    if(<%= !!character.skill_set.skill_occupation %>) {
      occupationalSkillList.updateOccupation();
    }

    new CoC.SkillTable( {
      tableId: 'skill_table',
      allSkills: <%= all_skills( character ).to_a.to_json.html_safe %>,
      skillCategories: <%= SkillSet::SKILL_CATEGORIES.to_a.to_json.html_safe %>,
      pointTracker: pointTracker
    });
  });
</script>